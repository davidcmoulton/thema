/**
 * A script to generate `../themes/themes.ts`
 *
 * Run using `npm run build:themes`.
 *
 * This doesn't actually build any themes,
 * it just makes an index of them.
 */

import fs from 'fs'
import globby from 'globby'
import path from 'path'

const themes = globby.sync('*', {
  onlyDirectories: true,
  cwd: path.join(__dirname, '..', 'themes')
})

fs.writeFileSync(
  path.join(__dirname, '..', 'themes', 'themes.ts'),
  `// Generated by generate/${path.basename(__filename)}. Do not edit.

/**
 * Map of theme Javascript modules
 */
export const themes: {
  ${themes.map(theme => `${theme}: Promise<any>`).join('\n  ')}
} = {
  ${themes.map(theme => `${theme}: import('./${theme}')`).join(',\n  ')}
}
`
)

const indexPath = path.join(__dirname, '..', 'index.html')
const index = fs.readFileSync(indexPath, 'utf8')
fs.writeFileSync(
  indexPath,
  index.replace(
    /(<!-- GENERATED-THEME-LINKS-BEGIN -->)[\s\S]*?(<!-- GENERATED-THEME-LINKS-END -->)/gm,
    `$1\n    ${themes
      .map(
        theme =>
          `<link id="${theme}" class="theme" rel="stylesheet" href="themes/${theme}/styles.css" disabled />`
      )
      .join('\n    ')}\n    $2`
  )
)
