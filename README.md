# Thema

> üé® Semantic themes for use with Stencila [`encoda`](https://github.com/stencila/encoda).

[![Build Status](https://travis-ci.org/stencila/thema.svg?branch=master)](https://travis-ci.org/stencila/thema)
[![Visual Regression Tests](https://img.shields.io/badge/Argos%20CI-Visual%20Regression%20tests-informational?style=flat)](https://www.argos-ci.com/stencila/thema)

- [Quick Start](#quick-start)
- [Available Themes](#available-themes)
- [Theme Structure](#theme-structure)
- [Development](#development)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
  - [Testing](#testing)
- [Technical Notes](#technical-notes)
- [Acknowledgments](#acknowledgments)

## Quick Start

```sh
npm install @stencila/thema
```

```css
/* myStyleSheet.css */
@import '@stencila/thema/dist/stencila/styles.css';
```

```js
/* myJavaScript.js */
@import '@stencila/thema/dist/stencila';
```

## Available Themes

- `stencila`: A custom designed theme suited for long-form reading,
  specifically research papers. It strives to deliver an optimal reading
  experience whilst giving figures and other media objects as much room as
  possible.
- `eLife`: Inspired by the eLife website, this theme provides as
  close of an approximation as possible for solely semantically structured
  documents such as Markdown.

## Theme Structure

There are two primary files inside each theme folder. The naming of these two
files is important, and they must not be changed since they are referred to
from `encoda`.

- `styles.css`: CSS and visual styles specific to the theme. We use PostCSS
  to compile the CSS, this is done to utilize PostCSS utilities such as
  autoprefixing vendor flags to selectors, and writing nested selectors.
- `index.ts`: Written in TypeScript, this file is loaded asynchronously. It is
  used to progressively enhance the theme with things like syntax highlighting
  of code blocks.

## Development

### Prerequisites

- [Node.js](https://nodejs.org/en/)
- [npm](https://www.npmjs.com)
- [git](https://git-scm.com)

### Installation

1. Clone this repository

```sh
git clone git@github.com:stencila/thema.git
```

2. Install dependencies

```sh
npm install
```

3. Run development server

```sh
npm run dev
```

### Testing

We use visual regression testing powered by [Sauce Labs](https://saucelabs.com), [Argos](https://www.argos-ci.com), and [WebdriverIO](https://webdriver.io).
The themes are built, rendered in a browser running on Sauce Labs, and screenshots taken and compared by Argos, with the build results for Thema [viewable here](https://www.argos-ci.com/stencila/thema/).

To run these tests locally, run `npm run test`.
By default Webdriver will try to run the tests using Chrome, but you can switch to Firefox by setting an `TEST_BROWSER=firefox` environment variable.

When testing locally, there are three screenshot folders to be aware of inside the `test/screenshots` directory.

- `reference`: These are the baseline screenshots. To generate them, make sure your Git branch is free of any changes, and run `npm test`.
- `local`: These are screenshots generated by Webdriver tests, and will be compared to those found in the `reference` directory.
- `diff`: If any discrepancies are found between the `reference` and `local` screenshots, the differences will be highlighted and saved to this directory.

Results for online visual regression tests can be seen at [argos-ci.com/stencila/thema](https://www.argos-ci.com/stencila/thema).

## Technical Notes

We use [Parcel](https://parceljs.org) to compile this module. One of the
plugins we utilize to generate transportable and offline-viewable documents
is [`parcel-plugin-url-loader`](https://github.com/stencila/parcel-plugin-url-loader)
to base64 encode and inline binary assets found in the CSS. This has the
tradeoff that it leads to much larger page sizes, but the ability to generate
stylesheets without inlining assets is on the roadmap.

## Acknowledgments

We rely on many tools and services for which we are grateful ‚ù§ to their developers and contributors for all their time and energy.

| Tool                                                                                                                                                       | Use                                                                                                |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| <a href="Sauce Labs"><img src="./.github/PoweredBySauceLabs.svg" width="150" alt="Testing powered by Sauce Labs" /></a>                                    | Cross-browser Testing Platform and Open Source <3 Provided by [Sauce Labs](https://saucelabs.com). |
| <a href="WebdriverIO"><img src="https://webdriver.io/img/webdriverio.png" width="50" alt="Next-gen WebDriver test framework for Node.js" />WebdriverIO</a> | Next-gen WebDriver test framework for Node.js.                                                     |
| [Argos CI](https://www.argos-ci.com)                                                                                                                       | visual regression system gives you high confidence in doing changes.                               |
